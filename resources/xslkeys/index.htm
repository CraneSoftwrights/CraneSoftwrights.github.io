<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <title>XSLT Key Illustration - Crane Softwrights Ltd.</title>
      <link type="text/css" rel="stylesheet" href="../../site.css">
      <link rel="shortcut icon" href="../../favicon.ico">
      <meta name="description" content="Crane Softwrights Ltd. is a Computer Systems Analysis consulting and training company specializing in  structured text processing using the XML and SGML families of technologies.">
      <meta name="keyword" content="XML Consulting - W3C XML">
      <meta name="keyword" content="XSL Consulting - W3C XSL">
      <meta name="keyword" content="XSL Training - W3C XSL">
      <meta name="keywords" content="SGML,DSSSL,XML,XSLT,XSL-FO,XQuery,UBL,code list, Universal Business Language, OmniMark,consulting,training, Crane,Softwrights,ISO,Ottawa,Ontario,Canada,Ottawa">
   </head>
   <body class="body global"><a name="_top"></a><table class="global" summary="banner navigation">
         <tr valign="top">
            <td width="100%">
               <div align="center" class="bannerTop banner"></div>
               
                 
                 
                 
               <h2>An Illustration of the XSLT Key Construct</h2>
               
               
               <p>The information below is an extract from <a href="http://www.CraneSoftwrights.com/">Crane Softwrights
                     Ltd.</a>'s XSLT/XPath book <i>Practical Transformation Using XSLT
                     and XPath</i> (ISBN 1-894049-06-3). The current edition can be
                  obtained through the <a href="http://www.CraneSoftwrights.com/training/">
                     http://www.CraneSoftwrights.com/training/</a> page. See that page
                  for details regarding the free updates of all editions to customers
                  of any edition.
               </p>
               
               
               <p>Section 8-2: Content and Document Referencing Techniques (Page
                  242)
               </p>
               
               
               <hr noshade>
                 
               <p>The stylesheet can identify key nodes of the source tree for
                    subsequent fast access by the XSLT processor: 
               </p>
               
               
               <center><img src="keytbl.gif" alt="keytbl.gif" border="0">
                  
               </center>
               
               
               <ul>
                  
                  <li type="disc">identifies all source tree nodes for each declared
                     key for stylesheet manipulation with a simple name
                  </li>
                  
                  
                  <li type="disc">builds lookup table of member items based on an
                     equality test for the lookup value
                  </li>
                  
                  
                  <li type="disc">e.g.: relate all employee records to the employee's
                     respective manager's employee record matching each employee's
                     <samp>ManagedBy</samp> sub-element content value with the
                     corresponding employee record with the same value for its <samp>
                        emp=</samp> attribute
                  </li>
                  
               </ul>
               
               
               <p>The XSLT processor can optimize searching in the lookup
                  table
               </p>
               
               
               <ul>
                  
                  <li type="disc">all values are fixed after the source tree is
                     processed
                  </li>
                  
                  
                  <li type="disc">the processor can index the table for quick
                     retrieval based on lookup value
                  </li>
                  
                  
                  <li type="disc">faster return of selected nodes than traversing the
                     axes using XPath expressions and predicates evaluated at the point
                     of reference
                  </li>
                  
               </ul>
               
               
               <p>Not all processors support <samp>&lt;xsl:key&gt;</samp> 
               </p>
               
               
               <p><u>Establishing a lookup table of key relationships in a
                     declarative fashion</u><br>
                  &nbsp;<br>
                  When indexing behavior similar to XML <samp>
                     ID</samp>/<samp>IDREF</samp> attribute cross-referencing values is
                  required by either attribute or element content, the stylesheet
                  writer can define and reference key values reflecting the implicit
                  cross-references:
               </p>
               
               
               <ul>
                  
                  <li type="disc">keys have three aspects of definition in the <samp>
                        &lt;xsl:key&gt;</samp> top-level instruction: 
                     
                     
                     <ul>
                        
                        <li type="disc">the namespace-qualified name of the key 
                           
                           
                           <ul>
                              
                              <li type="disc"><samp>
                                    name="<em><u>name-of-key-table</u></em>"</samp></li>
                              
                              
                              <li type="disc">the collection of key nodes distinguished from
                                 other collections of key nodes
                              </li>
                              
                              
                              <li type="disc">multiple declarations with the same name
                                 cumulatively build the members in the collection of that name
                              </li>
                              
                           </ul>
                           
                        </li>
                        
                        
                        <li type="disc">the nodes that have the key 
                           
                           
                           <ul>
                              
                              <li type="disc"><samp>
                                    match="<em><u>identifying-pattern-of-nodes-in-key-table</u></em>"</samp></li>
                              
                              
                              <li type="disc">a XPath matching pattern expression 
                                 
                                 
                                 <ul>
                                    
                                    <li type="disc">similar to <samp>count=</samp> attribute in <samp>
                                          &lt;xsl:number/&gt;</samp></li>
                                    
                                 </ul>
                                 
                              </li>
                              
                           </ul>
                           
                        </li>
                        
                        
                        <li type="disc">the lookup values of the keyed nodes 
                           
                           
                           <ul>
                              
                              <li type="disc"><samp>
                                    use="<em><u>expression-evaluating-the-value-of-key-in-the-set</u></em>"</samp></li>
                              
                              
                              <li type="disc">an XPath selection expression 
                                 
                                 
                                 <ul>
                                    
                                    <li type="disc">if relative, then evaluated relative to each keyed
                                       node
                                    </li>
                                    
                                 </ul>
                                 
                              </li>
                              
                              
                              <li type="disc">expression evaluated to a string</li>
                              
                              
                              <li type="disc">string values need not be unique 
                                 
                                 
                                 <ul>
                                    
                                    <li type="disc">nodes with like values are ordered in document
                                       order
                                    </li>
                                    
                                 </ul>
                                 
                              </li>
                              
                           </ul>
                           
                        </li>
                        
                     </ul>
                     
                  </li>
                  
                  
                  <li type="disc">the index built for a key is somewhat dissimilar to
                     <samp>ID</samp>/<samp>IDREF</samp> 
                     
                     
                     <ul>
                        
                        <li type="disc">key values in the set need not be unique 
                           
                           
                           <ul>
                              
                              <li type="disc">there can be multiple key nodes in a document with
                                 the same node, same key name, but different key values
                              </li>
                              
                              
                              <li type="disc">there can be multiple key nodes in a document with
                                 the same key name, same key value, but different nodes
                              </li>
                              
                           </ul>
                           
                        </li>
                        
                        
                        <li type="disc">a key's value need not be parsed as an XML name
                           token 
                           
                           
                           <ul>
                              
                              <li type="disc">a node relative to the key node can represent the
                                 key's value
                              </li>
                              
                              
                              <li type="disc">a key's value can be the result of an arbitrary
                                 expression evaluated with the key node as the current node
                              </li>
                              
                           </ul>
                           
                        </li>
                        
                        
                        <li type="disc">a lookup value need not be present in the
                           collection
                        </li>
                        
                     </ul>
                     
                  </li>
                  
               </ul>
               
               
               <p>Note that a variable reference cannot be used in either the <samp>
                     match=</samp> or <samp>use=</samp> expressions outside of a
                  predicate. 
               </p>
               
               
               <p><u>Using a key</u><br>
                  &nbsp;<br>
                  <samp>key(<em><u>key-name</u></em>,<em><u>non-node-set-value-converted-to-string</u></em>)</samp></p>
               
               
               <ul>
                  
                  <li type="disc">returns that subset of key nodes whose indexed key
                     value is equal to the given string lookup value
                  </li>
                  
               </ul>
               
               <samp>key(<em><u>key-name</u></em>,<em><u>node-set</u></em>)</samp>
               
               
               
               <ul>
                  
                  <li type="disc">returns the union of the call to <samp>key()</samp>
                     with the value of each of the nodes in the node set as a lookup
                     value
                  </li>
                  
               </ul>
               
               
               <p>Predicates can be applied to the returned node set </p>
               
               
               <ul>
                  
                  <li type="disc"><samp>key('taxes', 'Canada')[1]</samp> 
                     
                     
                     <ul>
                        
                        <li type="disc">returns only the first node of all nodes in the
                           '<samp>taxes</samp>' key table whose lookup value is the string
                           '<samp>Canada</samp>'
                        </li>
                        
                        
                        <li type="disc">like lookup values are returned in document order
                           of the nodes indexed, thus, this returns the first such node in
                           document order
                        </li>
                        
                     </ul>
                     
                  </li>
                  
                  
                  <li type="disc"><samp>key('taxes',
                        'Canada')[@type='federal'][1]</samp> 
                     
                     
                     <ul>
                        
                        <li type="disc">of all nodes returned by the key function, return
                           only the first whose <samp>type=</samp> attribute is
                           '<samp>federal</samp>'
                        </li>
                        
                     </ul>
                     
                  </li>
                  
               </ul>
               
               
               <p>The following example illustrates how keys can be used to obtain
                  the value of an employee's name indirectly from the value of an
                  attribute (though another model might have the value in sub-element
                  content) used to reference the employee information of a manager: 
               </p>
               
               
               <center><img src="key.gif" alt="key.gif" border="0"></center>
               
               
               <p>The following steps correspond to the diagram indicating how the
                  value "John Smith" is obtained as the name of the manager of "Joe
                  Green" indirectly through the <samp>emp=</samp> attribute of the
                  <samp>&lt;ManagedBy&gt;</samp> element: 
               </p>
               
               
               <ol>
                  
                  <li>the template rule for <samp>&lt;ManagedBy&gt;</samp> needs to
                     calculate a value from another node based on an attribute value in
                     <samp>emp=</samp> (in another model it could just as well be based
                     on an element node's value rather than an attribute node's
                     value)
                  </li>
                  
                  
                  <li>the target value calculation begins by first referencing the
                     key named "<samp>people</samp>", using the first argument to the
                     <samp>key()</samp> function, specifying which of the lookup key
                     tables that were created by the XSLT processor based on values
                     found in the source tree
                  </li>
                  
                  
                  <li>the key named "<samp>people</samp>" is declared in a top-level
                     <samp>&lt;xsl:key&gt;</samp> element building a table of nodes
                     matching the given node-set expression indicated with <samp>
                        match=</samp> (all element nodes named
                     "<samp>Employee</samp>")
                  </li>
                  
                  
                  <li>the <samp>use=</samp> attribute specifies the expression whose
                     evaluated value, relative to each <samp>match=</samp> node, that is
                     used for the lookup comparison value in the key table (the value of
                     the first child element node named "<samp>SSN</samp>" relative to
                     the element nodes named "<samp>Employee</samp>")
                  </li>
                  
                  
                  <li>the second argument to <samp>key()</samp> function indicates
                     the node (<samp>emp=</samp> attribute) relative to the current node
                     (<samp>ManagedBy</samp> element) whose value is used for the search
                     comparison with the key values (the attribute node for <samp>
                        emp=</samp>)
                  </li>
                  
                  
                  <li>the example indicates the string value "<samp>1234</samp>" is
                     what is searched for among the key lookup values
                  </li>
                  
                  
                  <li><samp>key()</samp> returns all key nodes (<samp>Employee</samp>
                     elements) whose lookup value is the string equivalent of the
                     expression value for what is being searched for (only one node in
                     this example)
                  </li>
                  
                  
                  <li>the <samp>&lt;xsl:value-of&gt;</samp> is calculated by then
                     evaluating the complete expression by obtaining the XPath
                     expression (the child element node named "<samp>Name</samp>")
                     relative to the returned set of key nodes (<samp>Employee</samp>
                     elements), thus returning the resulting value (the string "John
                     Smith")
                  </li>
                  
               </ol>
               
               
               <p>Note that the evaluation of <samp>key('people','1234')</samp> would
                  have produced the same result since the lookup value is the
                  supplied string instead of an evaluated expression. 
               </p>
               
               
            </td>
            <td width="200" style="border-left:solid 1pt; padding-left:5px"><img src="http://www.CraneSoftwrights.com/crane.gif" height="113" width="140" alt="Crane logo"><div class="letterheadCompany"><b> CRANE<br> SOFTWRIGHTS<br> LTD.<br></b></div>
               <div style="text-align:center;padding-top:1em"><small><a target="_blank" href="http://www.CraneSoftwrights.com/training/crane-courses.rss" class="button"><span style="background-color:orange;color:white;font-weight:bold">&nbsp;TRAINING&nbsp;RSS&nbsp;XML&nbsp;</span></a></small><br><small><a target="_blank" href="http://www.CraneSoftwrights.com/resources/crane-resources.rss" class="button"><span style="background-color:orange;color:white;font-weight:bold">&nbsp;RESOURCES&nbsp;RSS&nbsp;XML&nbsp;</span></a></small></div>
               <div style="text-align:center">
                  <div style="display:inline-block">
                     <div style="text-align:center;padding-top:0pt;border:2px solid;border-radius:10px;width:120px;background-color:#f5deb3">
                        <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank"><small><br><i>Please consider to</i></small><br><input type="hidden" name="cmd" value="_s-xclick"><input type="hidden" name="hosted_button_id" value="M4JQ6QH6T9JB6"><input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!"><img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1"><br><small><i>towards our<br>free resources.</i></small></form>
                     </div>
                  </div>
               </div>
               <div class="letterheadSite" style="padding-top:0pt">
                  <center class="letterheadTopic">XSLT Key Illustration</center>
                  <center class="letterheadOther"><a class="nostate" href="http://www.CraneSoftwrights.com/index.htm">Home</a></center>
                  <center class="letterheadOther"><a class="nostate" href="http://www.CraneSoftwrights.com/training/index.htm">Free books</a></center>
                  <center class="letterheadOther"><a class="nostate" href="http://www.CraneSoftwrights.com/resources/index.htm">Free resources</a></center>
                  <center class="letterheadOther"><a class="nostate" href="http://www.CraneSoftwrights.com/schedule.htm">Training</a></center>
                  <center class="letterheadOther"><a class="nostate" href="http://www.CraneSoftwrights.com/training/testimon.htm">Testimonials</a></center>
                  <center class="letterheadOther"><a class="nostate" href="http://www.CraneSoftwrights.com/bio/gkholman.htm">G. Ken Holman</a></center>
                  <center class="letterheadOther"><a class="nostate" href="http://www.CraneSoftwrights.com/contact.htm">Company &amp; contact information</a></center>
                  <center class="letterheadOther"><a class="nostate" href="http://www.CraneSoftwrights.com/goubl/index.htm">goUBL.com</a></center>
                  <center class="letterheadOther"><a class="nostate" href="http://www.CraneSoftwrights.com/site.htm">Site map</a></center>
               </div>
               <div style="text-align:center; padding-top:1em">
                  <div style="display:inline-block"><a href="http://www.CraneSoftwrights.com/links/ptux-coupon.htm" target="_blank"><img src="http://www.CraneSoftwrights.com/trainingblaze.png" target="_blank"></a></div>
               </div>
               <div class="letterheadAddress"><small><br>+1&nbsp;(613)&nbsp;489-0999&nbsp;(Voice)<br><br><a href="mailto:info@CraneSoftwrights.com">info@CraneSoftwrights.com</a><br><br></small></div>
            </td>
         </tr>
      </table>
      <hr>
      <p class="legend"><small><i><b>Link traversal:</b> This web site relies heavily on client-side redirection.  If certain links do not work for you, please ensure you have this
               behaviour enabled in your browser.</i></small></p>
      <p class="footerLinkHeadings">Site navigation:</p>
      <div class="bannerTop">
         <div align="center" class="banner"><span class="bannerEntry"><a class="nostate" href="http://www.CraneSoftwrights.com/index.htm">Home</a></span> <span class="bannerEntry"><a class="nostate" href="http://www.CraneSoftwrights.com/training/index.htm">Free&nbsp;books</a></span> <span class="bannerEntry"><a class="nostate" href="http://www.CraneSoftwrights.com/resources/index.htm">Free&nbsp;resources</a></span> <span class="bannerEntry"><a class="nostate" href="http://www.CraneSoftwrights.com/schedule.htm">Training</a></span> <span class="bannerEntry"><a class="nostate" href="http://www.CraneSoftwrights.com/training/testimon.htm">Testimonials</a></span> <span class="bannerEntry"><a class="nostate" href="http://www.CraneSoftwrights.com/bio/gkholman.htm">G.&nbsp;Ken&nbsp;Holman</a></span> <span class="bannerEntry"><a class="nostate" href="http://www.CraneSoftwrights.com/contact.htm">Company&nbsp;&amp;&nbsp;contact&nbsp;information</a></span> <span class="bannerEntry"><a class="nostate" href="http://www.CraneSoftwrights.com/goubl/index.htm">goUBL.com</a></span> <span class="bannerEntry"><a class="nostate" href="http://www.CraneSoftwrights.com/site.htm">Site&nbsp;map</a></span> 
         </div>
      </div>
      <p class="legend"><small><i><b>Small print:</b>
               All use of this web site and all business conducted 
               with Crane Softwrights Ltd. is subject to the legal disclaimers 
               detailed at 
               <a target="_blank" href="http://www.CraneSoftwrights.com/legal" class="external legenda">http://www.CraneSoftwrights.com/legal</a>
               ... please contact us if you have any questions.
               All trademarks, servicemarks, registered trademarks, and registered servicemarks are the property of their respective owners.
               </i></small></p>
      <p class="legend"><small><i><b>Link legend: </b>links that are
               <span class="external legenda">marked with this dotted underline</span>
               will open up a new browser window, otherwise the
               same browser window is used for the link 
               target.<small><a href="/donotlook.htm" class="robots">&nbsp;</a></small>
               <!--the preceding link is only for the use of robots, not visitors--></i></small></p>
      <p class="timestamp">Last changed: $Date: 2006/12/27 20:44:29 $(UTC) <a class="external" target="_blank" href="http://www.CraneSoftwrights.com/legal/privacy.htm">(Privacy policy)</a><br></p>
   </body>
</html>